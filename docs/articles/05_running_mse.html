<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running the MSE â€¢ SablefishMSE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running the MSE">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SablefishMSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.0000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/SablefishMSE.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/00_sablefish_example.html">Sablefish MSE Example</a></li>
    <li><a class="dropdown-item" href="../articles/01_operating_model.html">Defining an Operating Model</a></li>
    <li><a class="dropdown-item" href="../articles/02_recruitment.html">Specifying Recruitment</a></li>
    <li><a class="dropdown-item" href="../articles/03_estimation_model.html">Estimation Method</a></li>
    <li><a class="dropdown-item" href="../articles/04_management_procedure.html">Defining a Management Procedure</a></li>
    <li><a class="dropdown-item" href="../articles/05_running_mse.html">Running the MSE</a></li>
    <li><a class="dropdown-item" href="../articles/06_processing_mse_results.html">Processing MSE Output Data</a></li>
    <li><a class="dropdown-item" href="../articles/07_plotting_mse_results.html">Visualizing MSE Outputs</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Running the MSE</h1>
            
      

      <div class="d-none name"><code>05_running_mse.Rmd</code></div>
    </div>

    
    
<p>Once an operating model (OM) object, a recruitment object, and a
management procedure (MP) object have all been appropriately defined,
the MSE simulation loop can be almost be initiated.</p>
<div class="section level3">
<h3 id="mse-options">MSE Options<a class="anchor" aria-label="anchor" href="#mse-options"></a>
</h3>
<p>A list of MSE options must be defined to control internal aspects of
the MSE simulation loop, primarily how long to run the MSE for. The MSE
options object requires the following inputs:</p>
<ul>
<li>
<code>n_proj_years</code> - the number of projection years to run
the MSE for. This is the number of years for which the specified
management procedure will be applied.</li>
<li>
<code>n_spinup_years</code> - the number of years for which to apply
the specfied OM before, applying the specified MP. For sablefish, this
parameter is the number of years since 1960 (0-64), and indicates the
calendar year you would like to begin MSE siulations from.</li>
<li>
<code>recruitment_start_year</code> - which year of the simulation
new recruitment events should begin in. Often this is the same as
<code>n_spinup_years</code> but can be longer if the user wants to use a
specific recruitment timeseries at the beginning of the MSE
simulations.</li>
<li>
<code>run_estimation</code> - whether the estimation method should
run or not. If <code>FALSE</code> the management procedure will be
applied to OM outputs directly rather than to estimates from the
EM.</li>
</ul>
<p>Sensible defaults are available via the
<code>setup_mse_options</code> function. Using them will begin the MSE
simulations from the estimated population state in 2024, and project
forward for 100 years.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu">setup_mse_options</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">options</span></span></code></pre></div>
<pre><code><span><span class="co">## $n_proj_years</span></span>
<span><span class="co">## [1] 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $n_spinup_years</span></span>
<span><span class="co">## [1] 64</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $recruitment_start_year</span></span>
<span><span class="co">## [1] 64</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $run_estimation</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Note that the total number of simulation years for a single MSE run
is <code>n_spinup_years + n_proj_years</code>.</p>
</div>
<div class="section level3">
<h3 id="parallel-mse-simulations">Parallel MSE Simulations<a class="anchor" aria-label="anchor" href="#parallel-mse-simulations"></a>
</h3>
<p>Frequently, it is desirable to run multiple MSE simulations across
different random seeds, to evaluate an MP in the face of
uncertainty.</p>
<p>The <code>run_mse_parallel(...)</code> function is designed to act as
a simple parallel wrapper for the base <code>run_mse(...)</code>
function that will run multiple MSE simulations, with the same OM and MP
specifications, where each simulation will only vary by the random seed
used to generate annual recruitment levels and simulate
observations.</p>
<p>To use <code>run_mse_parallel</code> users must specify the number of
simulations to run, and provide a list of simulation seeds in addition
to the OM, MP, and options objects that are required for the base
<code>run_mse</code> function. <code>run_mse_parallel</code> will handle
parallelizing the MSE simulations and aggregating the output data as
simulations complete.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">run_mse_parallel</span><span class="op">(</span></span>
<span>    nsims <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    seeds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>    om<span class="op">=</span><span class="va">om</span>,</span>
<span>    hcr<span class="op">=</span><span class="va">mp</span>,</span>
<span>    mse_options<span class="op">=</span><span class="va">options</span>,</span>
<span>    nyears <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that this function will use up to <code>N-2</code> available
compute cores on a machine, so as to allow the machine to remain
functional. Parallel processing is enabled through use of the
<code>pblapply</code> package and associated function. Users <strong>DO
NOT</strong> need to handle creating their own parallel processing
cluster; this is handled internally.</p>
</div>
<div class="section level3">
<h3 id="multiple-mse-simulations">Multiple MSE Simulations<a class="anchor" aria-label="anchor" href="#multiple-mse-simulations"></a>
</h3>
<p>Often, multiple combinations of MPs and OMs are tested together
within an MSE to evaluate MPs across different states of nature. A
wrapper function <code>run_mse_multiple</code> is provided to faciliate
this and return appropiately formatted MSE outputs.</p>
<p>To use <code>run_mse_multiple</code>, users should define multiple
OM, MP, and/or MSE options objects, place them into lists, and pass the
respective lists to <code>run_mse_multiple</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">run_mse_multiple</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="co"># List of OMs to run</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="at">om_list =</span> <span class="fu">list</span>(om1, om2),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="co"># List of MPs to run</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="at">hcr_list =</span> <span class="fu">list</span>(mp1, mp2),</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="co"># List of MSE options to run</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">mse_options_list =</span> <span class="fu">list</span>(options)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">seed_list =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="dv">10</span>),</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="at">nyears=</span><span class="dv">1</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>)</span></code></pre></div>
<p><code>run_mse_multiple</code> will run all combinations of OMs, MPs,
and MSE Options provided in their respective lists, each for the number
of simulations provided in <code>seed_list</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joshua Zahner, Benjamin Williams, Dan Goethel, Curry Cunningham, Matt Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
